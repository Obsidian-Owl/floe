{{- if .Values.polaris.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "floe-platform.polaris.fullname" . }}-config
  labels:
    {{- include "floe-platform.labels" . | nindent 4 }}
    app.kubernetes.io/component: polaris
data:
  # Quarkus application.properties for Polaris 1.3.0+
  application.properties: |
    # HTTP configuration
    quarkus.http.port={{ .Values.polaris.service.port | default 8181 }}

    # Management interface (health, metrics)
    quarkus.management.enabled=true
    quarkus.management.port={{ .Values.polaris.service.managementPort | default 8182 }}

    # Feature flags
    polaris.features."SKIP_CREDENTIAL_SUBSCOPING_INDIRECTION"={{ .Values.polaris.config.features.SKIP_CREDENTIAL_SUBSCOPING_INDIRECTION | default "false" }}
    polaris.features."ALLOW_SETTING_S3_ENDPOINTS"={{ .Values.polaris.config.features.ALLOW_SETTING_S3_ENDPOINTS | default "false" }}
    polaris.features."ALLOW_TABLE_LOCATION_OVERLAP"={{ .Values.polaris.config.features.ALLOW_TABLE_LOCATION_OVERLAP | default "false" }}
    {{- if .Values.polaris.storage.s3.enabled }}
    # S3 storage configuration
    quarkus.s3.endpoint-override={{ .Values.polaris.storage.s3.endpoint }}
    quarkus.s3.path-style-access={{ .Values.polaris.storage.s3.pathStyleAccess | default true }}
    quarkus.s3.aws.region={{ .Values.polaris.storage.s3.region | default "us-east-1" }}
    # Server-level S3 credentials for credential vending
    polaris.storage.aws.access-key={{ .Values.polaris.storage.s3.accessKey }}
    polaris.storage.aws.secret-key={{ .Values.polaris.storage.s3.secretKey }}
    {{- end }}
{{- end }}
