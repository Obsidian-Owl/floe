{{- if .Values.polaris.enabled }}
{{- if not .Values.polaris.auth.existingSecret }}
{{/*
SECURITY: Polaris credentials secret.
Contains bootstrap credentials and S3 storage credentials.
For production, use polaris.auth.existingSecret to reference
credentials managed by External Secrets Operator or similar.
*/}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "floe-platform.polaris.fullname" . }}-credentials
  labels:
    {{- include "floe-platform.labels" . | nindent 4 }}
    app.kubernetes.io/component: polaris
type: Opaque
data:
  # Bootstrap credentials for Polaris admin principal
  client-id: {{ .Values.polaris.auth.bootstrapCredentials.clientId | b64enc | quote }}
  client-secret: {{ .Values.polaris.auth.bootstrapCredentials.clientSecret | b64enc | quote }}
  # Combined format for POLARIS_BOOTSTRAP_CREDENTIALS env var
  bootstrap-credentials: {{ printf "POLARIS,%s,%s" .Values.polaris.auth.bootstrapCredentials.clientId .Values.polaris.auth.bootstrapCredentials.clientSecret | b64enc | quote }}
  {{- if .Values.polaris.storage.s3.enabled }}
  # S3 storage credentials
  aws-access-key-id: {{ .Values.polaris.storage.s3.accessKey | b64enc | quote }}
  aws-secret-access-key: {{ .Values.polaris.storage.s3.secretKey | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}
