{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://floe.dev/schemas/sarif-output.json",
  "title": "FloeEnforcementSARIF",
  "description": "SARIF 2.1.0 output format for floe policy enforcement results",
  "$comment": "Subset of SARIF 2.1.0 for GitHub Code Scanning integration",
  "type": "object",
  "required": ["$schema", "version", "runs"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://json.schemastore.org/sarif-2.1.0.json"
    },
    "version": {
      "type": "string",
      "const": "2.1.0"
    },
    "runs": {
      "type": "array",
      "minItems": 1,
      "maxItems": 1,
      "items": {
        "$ref": "#/$defs/run"
      }
    }
  },
  "$defs": {
    "run": {
      "type": "object",
      "required": ["tool", "results"],
      "properties": {
        "tool": {
          "$ref": "#/$defs/tool"
        },
        "results": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/result"
          }
        }
      }
    },
    "tool": {
      "type": "object",
      "required": ["driver"],
      "properties": {
        "driver": {
          "type": "object",
          "required": ["name", "version", "rules"],
          "properties": {
            "name": {
              "type": "string",
              "const": "floe-policy-enforcer"
            },
            "version": {
              "type": "string",
              "pattern": "^\\d+\\.\\d+\\.\\d+$"
            },
            "informationUri": {
              "type": "string",
              "format": "uri"
            },
            "rules": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/rule"
              }
            }
          }
        }
      }
    },
    "rule": {
      "type": "object",
      "required": ["id", "name", "shortDescription"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^FLOE-E[0-9]{3}$",
          "description": "Floe error code"
        },
        "name": {
          "type": "string",
          "description": "Human-readable rule name"
        },
        "shortDescription": {
          "type": "object",
          "required": ["text"],
          "properties": {
            "text": {
              "type": "string"
            }
          }
        },
        "fullDescription": {
          "type": "object",
          "properties": {
            "text": {
              "type": "string"
            }
          }
        },
        "help": {
          "type": "object",
          "properties": {
            "text": {
              "type": "string"
            }
          }
        },
        "defaultConfiguration": {
          "type": "object",
          "properties": {
            "level": {
              "type": "string",
              "enum": ["error", "warning", "note"]
            }
          }
        }
      }
    },
    "result": {
      "type": "object",
      "required": ["ruleId", "level", "message"],
      "properties": {
        "ruleId": {
          "type": "string",
          "pattern": "^FLOE-E[0-9]{3}$"
        },
        "level": {
          "type": "string",
          "enum": ["error", "warning", "note"]
        },
        "message": {
          "type": "object",
          "required": ["text"],
          "properties": {
            "text": {
              "type": "string"
            }
          }
        },
        "locations": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/location"
          }
        },
        "fixes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "description": {
                "type": "object",
                "properties": {
                  "text": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "location": {
      "type": "object",
      "properties": {
        "physicalLocation": {
          "type": "object",
          "properties": {
            "artifactLocation": {
              "type": "object",
              "required": ["uri"],
              "properties": {
                "uri": {
                  "type": "string",
                  "description": "Path to the model file"
                }
              }
            },
            "region": {
              "type": "object",
              "properties": {
                "startLine": {
                  "type": "integer",
                  "minimum": 1
                },
                "startColumn": {
                  "type": "integer",
                  "minimum": 1
                }
              }
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "$schema": "https://json.schemastore.org/sarif-2.1.0.json",
      "version": "2.1.0",
      "runs": [
        {
          "tool": {
            "driver": {
              "name": "floe-policy-enforcer",
              "version": "0.2.0",
              "informationUri": "https://floe.dev/docs/policy-enforcement",
              "rules": [
                {
                  "id": "FLOE-E201",
                  "name": "naming-violation",
                  "shortDescription": {
                    "text": "Model name violates naming convention"
                  },
                  "defaultConfiguration": {
                    "level": "error"
                  }
                }
              ]
            }
          },
          "results": [
            {
              "ruleId": "FLOE-E201",
              "level": "error",
              "message": {
                "text": "Model 'stg_customers' violates medallion naming convention. Expected: bronze_*, silver_*, or gold_*"
              },
              "locations": [
                {
                  "physicalLocation": {
                    "artifactLocation": {
                      "uri": "models/staging/stg_customers.sql"
                    }
                  }
                }
              ],
              "fixes": [
                {
                  "description": {
                    "text": "Rename model to follow medallion pattern (e.g., bronze_customers, silver_customers, or gold_customers)"
                  }
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
